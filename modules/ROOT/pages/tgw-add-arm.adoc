= Add Transit Gateway Attachments
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

image:logo-cloud-active.png[link="/runtime-manager/deployment-strategies#cloudhub", title="CloudHub"]
image:logo-hybrid-disabled.png[link="/runtime-manager/deployment-strategies#hybrid", title="Hybrid"]
image:logo-server-disabled.png[link="/runtime-manager/deployment-strategies#anypoint-platform-private-cloud-edition", title="Anypoint Platform PCE"]
image:logo-rtf-disabled.png[link="/runtime-manager/deployment-strategies#anypoint-runtime-fabric", title="Runtime Fabric"]


Use Runtime Manager to add a transit gateway and connect your MuleSoft Virtual Private Cloud (VPC) to your private corporate network.


== Prerequisites

Before you can add a transit gateway:

* Purchase an Anypoint VPC offering with Transit Gateway entitlements.
+
The *Transit Gateways* page in Runtime Manager is visible to Anypoint organizations that have Transit Gateway entitlements. 
* Sign in to an Anypoint Platform account with either the CloudHub Network Administrator or the CloudHub Network Viewer user permission.
+
See xref:access-management::users.adoc#granting-permissions-and-roles-to-users[Granting Permissions and Roles to Users].
* Set your default environment (in your profile) to an environment with Read Application permissions.
+
See xref:access-management::managing-your-account.adoc#update-user-information[Update User Information].
* Create an Anypoint VPC in Anypoint Platform.
+
See xref:vpc-tutorial.adoc[Create and Update a VPC for Runtime Manager].
* Create a transit gateway on your corporate AWS account.
+
You must have access to this AWS account to add a transit gateway.
+
See https://docs.aws.amazon.com/vpc/latest/tgw/tgw-getting-started.html[Getting started with transit gateways] in the AWS documentation for information about creating a transit gateway on AWS.
+
One Anypoint VPC can accommodate up to *???* Transit Gateways.
* Identify the subnets in your network (in CIDR notation) that you want to make accessible through the transit gateway.


== Overview 

The steps for adding a Transit Gateway to your VPC are:

. Add the transit gateway in Anypoint Platform.
. Create a Resource Share in AWS to share your transit gateway with Anypoint Platform.
. Attach your VPCs to the transit gateway.
. Accept the VPC attachments in AWS.
. Add VPC routes.


== Add a Transit Gateway

To add a transit gateway:

. Sign in to Anypoint Platform and select *Runtime Manager*.
. Switch to the environment where you want to add a transit gateway.
+
See xref:runtime-manager-switch-env.adoc[Use Different Environments in Runtime Manager].
. From the Runtime Manager navigation menu, click *Transit Gateways*, and then click *Add Transit Gateway*.
+
The *Here's what's coming* page lists the steps to add the transit gateway:
+
image::tgw-overview.png[Overview of the steps to add the transit gateway]
. Click *I'm ready*. 
. Specify a name for your transit gateway.
+
Use the same name for your transit gateway in AWS.
You can change this name later.
The name can contain up to 255 alphanumeric characters (a-z, A-Z, 0-9) and hyphens (-).
// They cannot start or end with a hyphen and cannot contain spaces or other characters.
. Select the region that corresponds to the location your AWS transit gateway.
+
See xref:cloudhub-networking-guide.adoc#regional-services[Regional Services].
+
Your VPC and AWS transit gateway must be in the same region.
. Click *Next*.
+
The *Add transit gateway* page lists the steps to create a resource share in AWS:
+
image::tgw-resource-share-overview.png[Overview of the steps to create a resource share in AWS]


== Create a Resource Share

. Sign in to your AWS corporate account.
. In Anypoint Platform, click the *Create Resource Share page* link on the *Add transit gateway* page. 
+
The link opens the AWS RAM console to the page for creating a resource share in the region you specified.
. In the *Create resource share* page on AWS: 
+
--
.. Under *Description*, enter a descriptive name for the resource share in the *Name* field.
.. Under *Resources - _optional_*, select *Transit Gateways* from the *Select resource type* menu and select the transit gateway resource to share.
+
The transit gateway ID appears in the *Selected resources* field.
.. Under *Principals - _optional_*, ensure that *Allow external accounts* is selected, enter the MuleSoft AWS account ID (`073815667418`), and click *Add*.
+
The AWS account number appears in the *Selected principals* field.
.. Click *Create resource share*.
.. Copy the following values for the resource share you just created: *ID* and *Owner*.
--
. In Anypoint Platform, in the *Add transit gateway* window: 
+
--
.. Click *Next*.
.. Paste the values you copied from AWS in the *ID* and *Owner* fields.

*** The resource share *ID* field contains alphanumeric characters (a-z, A-Z, 0-9) and hyphens (-).
*** The resource share *Owner* field contains only numbers.

.. Click *Add*.
--
+
The *Transit Gateways* page shows the progress for connecting to AWS and adding the transit gateway to Anypoint Platform.

When the transit gateway addition succeeds, the *Transit Gateways* page displays the *Transit gateway added* message.
The *Transit Gateways* page updates the owner and ID from AWS and the State as *Available*:

image::tgw-resource-share-available.png[Transit gateway added]

If the transit gateway addition fails, see xref:tgw-troubleshoot.adoc[Troubleshoot Transit Gateway Attachments].

== Attach a VPC to the Transit Gateway

After the transit gateway attachment succeeds, you can attach your VPC.

To attach a VPC to the transit gateway:

. In Anypoint Platform, on the *Transit Gateways* page, click *Attach VPC*.
+
The *Attach VPC* button is disabled if no VPCs are available to attach or if the transit gateway addition failed. 
. From the *Select VPC* window, select the VPC to attach.
+
The window displays only the VPCs that you manage in the same region as the transit gateway.
The window doesn't display VPCs:
+
--
* In other regions
* Already attached to a transit gateway
* In Business Groups for which you don't have Cloudhub Network Administrator permissions
--
. Click *Next*.
. Sign in to your AWS corporate account.
. In the *Accept VPC Attachment* window: 
+
.. Click the *Transit Gateway Attachments page* link. 
+
The link opens the AWS RAM console to the page for accepting the transit gateway attachments in the region you specified.
.. On the *Transit Gateway Attachments* page, select the attachment that shows *pending* in the *State* column.
+
The attachment might take a few minutes to appear.
+
To verify that the attachment is correct, select the Transit Gateway attachment ID and, in the *Details* tab, ensure that the *Resource owner account ID* is the MuleSoft AWS account ID (`073815667418`)
.. From the *Actions* menu, select *Accept*.
. In Anypoint Platform, in the *Accept VPC Attachment* window, click *Done*.
+
The *Transit Gateways* page shows the progress for accepting the VPC attachment from Anypoint Platform to AWS.

When the VPC attachment succeeds, the *Transit Gateways* page displays the *VPC attached* message, and the VPC shows the `Attached successfully` message.

If the VPC attachment fails, see xref:tgw-troubleshoot.adoc[Troubleshoot Transit Gateway Attachments].

== Add Routes to the Transit Gateway Route Table

After the *VPC attached* message appears, you can add routes so apps deployed to the VPC can access the transit gateway.

To add routes to the transit gateway route table:

. On the *Transit Gateways* page, in the *VPCs* section, click *Add Route*. 
. In the *Add VPC route* window, enter a single subnet in CIDR notation.
+
For information, see xref:tgw-about.adoc#routing[Transit Gateway Routing].
. Click *Add route*.
+
Anypoint Platform submits the new route to AWS.

When the route addition succeeds, the *Transit Gateways* page shows the *Route added* message
and the *Transit Gateways* page shows the route CIDR in the route table.

In the route table, added routes show *Transit Gateway* as the value in the *Next hop* column. 

== Access AWS from Anypoint Platform

To access the relevant console on AWS, click the *View on AWS* button on the *Transit Gateways* page:

image::tgw-view-on-aws.png[View on AWS button on the Transit Gateways page]



== See Also

* xref:tgw-troubleshoot.adoc[Troubleshoot Transit Gateway Attachments]
* xref:tgw-manage-arm.adoc[Manage Transit Gateway Attachments]
* xref:tgw-about.adoc[Transit Gateway Attachments]
* xref:virtual-private-cloud.adoc[Virtual Private Cloud]
* xref:vpc-tutorial.adoc[Create and Update a VPC for Runtime Manager]
* xref:access-management::users#granting-permissions-and-roles-to-users[Granting Permissions and Roles to Users]
