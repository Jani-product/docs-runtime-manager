= Add a Transit Gateway
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

image:logo-cloud-active.png[link="/runtime-manager/deployment-strategies#cloudhub", title="CloudHub"]
image:logo-hybrid-disabled.png[link="/runtime-manager/deployment-strategies#hybrid", title="Hybrid"]
image:logo-server-disabled.png[link="/runtime-manager/deployment-strategies#anypoint-platform-private-cloud-edition", title="Anypoint Platform PCE"]
image:logo-rtf-disabled.png[link="/runtime-manager/deployment-strategies#anypoint-runtime-fabric", title="Runtime Fabric"]


You can create a CloudHub Transit Gateway connection using Runtime Manager. 


== Prerequisites

Before you can add a transit gateway:

* Purchase an Anypoint VPC offering with Transit Gateway entitlements.
+
The *Transit Gateways* page is visible to Anypoint organizations that have Transit Gateway entitlements. 
* Sign in to an Anypoint Platform account with either the CloudHub Network Administrator or the CloudHub Network Viewer user permission.
+
See xref:access-management::users.adoc#granting-permissions-and-roles-to-users[Granting Permissions and Roles to Users].
* Set your default environment (in your profile) to an environment with Read Application permissions.
+
See xref:access-management::managing-your-account.adoc#update-user-information[Update User Information].
* Create an Anypoint VPC in Anypoint Platform.
+
See xref:vpc-tutorial.adoc[Create and Update a VPC for Runtime Manager].
* Create a transit gateway on your corporate AWS account.
+
You must have access to this AWS account to add a transit gateway.
+
See https://docs.aws.amazon.com/vpc/latest/tgw/tgw-getting-started.html[Getting started with transit gateways] in the AWS documentation for information about creating a transit gateway on AWS.
+
One Anypoint VPC can accommodate up to xxx Transit Gateways.
* Identify the subnets in your network (in CIDR notation) that you want to make accessible through the transit gateway.


== Overview 

The steps for adding a Transit Gateway to your VPC are:

. Create the transit gateway in Anypoint Platform.
. Create a Resource Share in AWS to share your transit gateway with Anypoint Platform.
. Attach your VPCs to the transit gateway.
. Accept the VPC attachments in AWS.
. Add VPC routes.


== Add a Transit Gateway

To add a transit gateway:

. Sign in to Anypoint Platform and select *Runtime Manager*.
. Select the environment where you want to add a transit gateway.
+
See xref:runtime-manager-switch-env.adoc[Use Different Environments in Runtime Manager].
. From the Runtime Manager navigation menu, click *Transit Gateways*, and then click *Add Transit Gateway*.
+
The *Here's what's coming* page lists the steps to add the transit gateway. 
. Click *I'm ready*. 
. Specify a name for your transit gateway.
+
Use the transit gateway name from AWS. 
You can change this name later.
. Select the region that corresponds to the location your AWS transit gateway.
+
See xref:cloudhub-networking-guide.adoc#regional-services[Regional Services].
. Click *Next*.
+
The *Add transit gateway* page lists the steps to create a resource share in AWS.

== Create a Resource Share

. Sign in to your AWS corporate account.
. In Anypoint Platform, click the *Create Resource Share page* link. 
+
The link opens the AWS RAM console to the page for creating a resource share in the region you specified.
. In the *Create Resource Share* page: 
+
--
.. In *Name*, enter a name for the resource share.
.. Under *Resources - _optional_*, select *Transit Gateways* from the resource type and select the transit gateway resource to share.
.. Under *Principals - _optional_*, enter the MuleSoft AWS account ID (`073815667418`), and click *Add*.
.. Click *Create resource share*.
.. Copy the following values for the resource share: *ID* and *Owner*.
--
. In Anypoint Platform, in the *Add transit gateway* window: 
+
--
.. Click *Next*.
.. Paste the values you copied from AWS in the *ID* and *Owner* fields. 
.. Click *Add*.
--
+
The *Transit Gateways* page shows the progress for connecting to AWS and adding the transit gateway to Anypoint Platform.
+
screenshot

When the transit gateway addition succeeds, the *Transit Gateways* page displays the *Transit gateway added* message.
The Transit Gateway ID and Transit Gateway Owner appear with the State of *Available*.

If the transit gateway addition fails, see xref:tgw-troubleshoot.adoc[Troubleshoot Transit Gateway Connections].

== Attach a VPC to the Transit Gateway

After the *Transit gateway added* message appears, you can attach your VPC.

To attach a VPC to the transit gateway:

. In Anypoint Platform, on the *Transit Gateways* page, click *Attach VPC*.
+
The *Attach VPC* button is disabled if no VPCs are available to attach or if the transit gateway addition failed. 
. From the *Select VPC* window, select the VPC to attach.
+
The window displays all VPCs that are not currently attached to a transit gateway in the Business Groups for which you have Cloudhub Network Administrator permissions.
. Click *Next*.
. Sign in to your AWS corporate account.
. In the *Accept VPC attachment* window: 
+
.. Click the *Transit Gateway Attachments* link. 
+
The link opens the AWS RAM console to the page for accepting the transit gateway attachments in the region you specified.
.. On the *Transit Gateway Attachments* page, select the attachment that shows *pending* in the *State* column.
+
The attachment might take a few minutes to appear.
+
To verify that the attachment is correct, click the link in the *Transit Gateway ID* and ensure that the *Resource Owner Account ID* is the MuleSoft AWS account number (`073815667418`)
.. From the *Actions* menu, select *Accept*.
. In Anypoint Platform, in the *Accept VPC attachment* window, click *Done*.
+
The *Transit Gateways* page shows the progress for accepting the VPC attachment from Anypoint Platform to AWS.

When the VPC attachment succeeds, the *Transit Gateways* page displays the *VPC attached* message, and the VPC shows the `Attached successfully` message.

If the VPC attachment fails, see xref:tgw-troubleshoot.adoc[Troubleshoot Transit Gateway Connections].

== Add Routes to the Transit Gateway Route Table

After the *VPC attached* message appears, you can add routes so apps deployed to the VPC can access the transit gateway.

To add routes to the transit gateway route table:

. On the *Transit Gateways* page, in the *VPCs* section, click *Add route*. 
. In the *Add VPC route* window, enter a single subnet in CIDR notation.
+
For information, see xref:tgw-about.adoc#routing[Transit Gateway Routing].
. Click *Add route*.
+
Anypoint Platform submits the new route to AWS.

When the route addition succeeds, the *Transit Gateways* page shows the *Route added* message
and the *Transit Gateways* page shows the route CIDR in the route table.

In the route table, added routes show *TGW* as the value in the *Next hop* column. 

== Access AWS from Anypoint Platform

To access the relevant console on AWS, click the *View on AWS* button at the top of the *Transit Gateways* page.



== Manage Transit Gateway Connections

* <<Rename a Transit Gateway>>
* <<Remove a Route from the Transit Gateway Route Table>>
* <<Detach an Anypoint VPC from the Transit Gateway>>
* <<Remove a Transit Gateway from Anypoint Platform>>


=== Rename a Transit Gateway 

To rename a transit gateway:

. At the top of the *Transit Gateways* page, click the *...* and select *Rename*.
. In the popup window, enter a new name and click *Save*.


=== Remove a Route from the Transit Gateway Route Table

To remove a route:

. On the *Transit Gateways* page, in the *VPCs* section, click the *X* icon in the row for a TGW route in the route table.
. At the confirmation prompt, click *Remove*.

=== Detach an Anypoint VPC from the Transit Gateway

Because detaching a VPC from a transit gateway also deletes the attachment in AWS,
undeploy any apps deployed to the VPC before detaching the VPC.

To detach a VPC from the transit gateway:

. On the *Transit Gateways* page, in the *VPCs* section, click *...* next to the *Add route* button and select *Detach*.
. At the confirmation prompt, click *Detach*.


=== Remove a Transit Gateway from Anypoint Platform

If a transit gateway has no VPCs attached, you can remove it from Anypoint Platform. 

[NOTE]
Removing a transit gateway deletes the resource share in AWS that Anypoint Platform uses to access the transit gateway.

To remove a transit gateway from Anypoint Platform:

. At the top of the *Transit Gateways* page, click the *...* and select *Remove*.
+
Anypoint Platform prevents you from removing a transit gateway if it has VPCs attached.
+
If the *Transit Gateways* page doesn't list any VPCs, but you can't delete the transit gateway, the transit gateway might be attached to a VPC that belongs to another business group that you don't have access to.
. At the confirmation prompt, click *Remove*.


== See Also

* xref:tgw-troubleshoot.adoc[Troubleshoot Transit Gateway Connections]
* xref:tgw-about.adoc[CloudHub Transit Gateway]
* xref:virtual-private-cloud.adoc[Virtual Private Cloud]
* xref:vpc-tutorial.adoc[Create and Update a VPC for Runtime Manager]
* xref:access-management::users#granting-permissions-and-roles-to-users[Granting Permissions and Roles to Users]
