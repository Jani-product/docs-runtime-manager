= Deploying to CloudHub
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: cloudhub, cloud, deploy, manage, runtime manager, arm


image:logo-cloud-active.png[link="/runtime-manager/deployment-strategies#cloudhub", title="CloudHub"]
image:logo-hybrid-disabled.png[link="/runtime-manager/deployment-strategies#hybrid", title="Hybrid"]
image:logo-server-disabled.png[link="/runtime-manager/deployment-strategies#anypoint-platform-private-cloud-edition", title="Anypoint Platform PCE"]
image:logo-rtf-disabled.png[link="/runtime-manager/deployment-strategies#anypoint-runtime-fabric", title="Runtime Fabric"]

You can deploy Mule applications to CloudHub using:


* xref:deploying-to-cloudhub.adoc#deploy-an-application-from-runtime-manager[Anypoint Runtime Manager]
* xref:deploying-to-cloudhub.adoc#deploy-an-application-from-studio[Anypoint Studio]
* xref:deploying-to-cloudhub.adoc#deploy-an-application-from-the-command-line[CloudHub CLI]
* xref:design-center::promote-app-prod-env-design-center.adoc[Flow Designer in Anypoint Design Center]
* https://anypoint.mulesoft.com/exchange/portals/anypoint-platform/f1e97bc6-315a-4490-82a7-23abe036327a.anypoint-platform/cloudhub-api/[CloudHub API]
* xref:mule-runtime::deploy-to-cloudhub.adoc[Mule Maven plugin]

You can also deploy an API proxy directly from API Manager to CloudHub.
See xref:api-manager::getting-started-proxy.adoc#configure_and_deploy_to_cloudhub[Configure a Proxy and Deploy to CloudHub].


To be notified by email when an error occurs during deployment, set up a *Deployment failed* alert.
See xref:alerts-on-runtime-manager.adoc#create-an-alert[Create an Alert].


== Deploy an Application from Runtime Manager

To deploy from Runtime Manager to CloudHub:

. Sign in to Anypoint Platform.
. Select *Runtime Manager*.
. In the *Applications* page, click *Deploy application*.
+
You see the *Deploy Application* page:
+
.The screenshot shows (*1*) the *Application Name* field, (*2*) the *Choose file* menu, and (*3*) the *Deploy Application* button on the *Deploy Application* page.
image::cloudhub-deploy-app.png[Application Name field, Choose file menu, and the Deploy Application button]
. Provide a name for your application.
+
See <<Application Names>>.

. In the *Deployment Target* menu, select *CloudHub*, if it is not already selected.
. Specify the application file:
+
--
** Import a file from Exchange:

.. Click *Choose file* > *Import file from Exchange*.
.. Select *Application* for the type.
.. Enter the name of your application in the search box.
.. Select the application to deploy, select a version from the *Version* menu, and then click *Select*.

** Upload an application archive (ZIP or JAR) file:

.. Select *Choose file* > *Upload file*.
.. Select the file to upload and then click *Open*.
+
The application file size limit is 200 MB.

** Copy an application from a nonproduction environment.
+
See <<Copy an Application from Sandbox to Production>>.
--
. Click tabs to configure application options.
+
See <<Configure Application Settings>>.
. Click *Deploy Application*.




== Deploy an Application from Studio

You can deploy your applications directly from Studio to CloudHub.
This option is helpful if you want to test your application while developing it.

[NOTE]
--
You can deploy an application from Studio to any environment except *Design*.
The *Design* environment is specific to applications created in Anypoint Design Center.
See xref:design-center::promote-app-prod-env-design-center.adoc[Deploy a Mule Application from Flow Designer].
--

To deploy from Studio to CloudHub:

. Open your application in Studio.
. In *Package Explorer*, right-click the project folder and select *Anypoint Platform > Deploy to CloudHub*.
. If this is your first time deploying from Studio, provide your Anypoint Platform credentials at the prompt.
+
Studio stores your credentials for future use.
You can manage these credentials by selecting *Anypoint Studio > Preferences > Anypoint Studio > Authentication*.
+
After you sign in, you see the *Deploying Application* page:
+
.The screenshot shows (*1*) the *Application Name* field, (*2*) the *Deploy Application* button on the *Deploying Application* page.
image::cloudhub-deploy-app-studio.png[Application Name field and the Deploy Application button]
. Change the application name, if necessary.
. Click tabs to configure application options.
+
See <<configure-application-settings,Configure Application Settings>>.
. Click *Deploy Application*.



== Deploy an Application from the Command Line 

To deploy a Mule app from the CloudHub command-line interface (CLI):

. If you do not already have access to the Anypoint command-line tool, install it. 
+
See xref:anypoint-platform-cli.adoc[Anypoint Platform CLI].
. Log into your Anypoint Platform account from the command line:
+
--
.. Enter your username:
+
`anypoint-cli --username="user"`
.. At the prompt, enter your password.
--
. Run the following command, replacing `myMuleApp` with the deployment name of your app and `/Users/exported-app-folder/my-mule-app.jar` with the path to the deployable archive (JAR or ZIP) file on your file system:
+
----
runtime-mgr cloudhub-application deploy myMuleApp /Users/exported-app-folder/my-mule-app.zip
----
+
The command-line utility displays a table of deployment information:
+
----
Deploying myMuleApp ...
┌──────────────────────────────┬────────────────────────────────────────┐
│ Domain                       │ mymuleapp.cloudhub.io                  │
├──────────────────────────────┼────────────────────────────────────────┤
│ Status                       │ UNDEPLOYED                             │
├──────────────────────────────┼────────────────────────────────────────┤
│ Updated                      │ a few seconds ago                      │
├──────────────────────────────┼────────────────────────────────────────┤
│ Runtime                      │ 4.1.0                                  │
├──────────────────────────────┼────────────────────────────────────────┤
│ File name                    │ my-mule-app.zip                        │
├──────────────────────────────┼────────────────────────────────────────┤
│ Persistent queues            │ false                                  │
├──────────────────────────────┼────────────────────────────────────────┤
│ Persistent queues encrypted  │ false                                  │
├──────────────────────────────┼────────────────────────────────────────┤
│ Static IPs enabled           │ false                                  │
├──────────────────────────────┼────────────────────────────────────────┤
│ Monitoring                   │ Enabled. Auto-restart if not responding│
├──────────────────────────────┼────────────────────────────────────────┤
│ Workers                      │ 1 vCore * 1                            │
----
+
After you deploy the app on CloudHub, you can view and manage it on Runtime Manager.
. If you want to stop the app from the command line, run the following command, replacing `app-name` with the deployment name of your app:
+
`runtime-mgr cloudhub-application stop app-name`

To exit the command-line tool, press Ctrl+c twice.

For a complete list of the commands, see xref:anypoint-platform-cli.adoc[Anypoint Platform CLI].




== Copy an Application from Sandbox to Production

If you create and test an application in a sandbox environment, you must move it to the 
production environment before deploying it.
You must have the CloudHub Admin role to move applications between environments.

To avoid name conflicts, rename the application before you deploy it to another environment.

Runtime Manager prevents you from duplicating applications in a single environment,
so you cannot move an application into the environment it's already in.
If you want to duplicate an application in a single environment, rename the filename of one application
before you deploy it.

To move an application from sandbox to production:

. Sign in to Anypoint Platform.
. Select *Runtime Manager* and switch to your production environment.
+
See xref:runtime-manager-switch-env.adoc##switch-environments-using-runtime-manager[Switch Environments Using Runtime Manager].
. In the *Applications* page, click *Deploy application*.
+
You see the *Deploy Application* page:
+
.The screenshot shows (*1*) the *Application Name* field, (*2*) the *Get from sandbox* button, and (*3*) the *Deploy Application* button on the *Deploy Application* page.
image::cloudhub-deploy-app-sandbox.png[Application Name field and Get from sandbox and Deploy Application buttons]
. Provide a unique name for your application in production and click *Get from sandbox*.
+
This button is unavailable if no nonproduction environment exists.
. Select your sandbox environment and then the application that you want to move to production.
+
Only applications that are deployed to CloudHub appear in the list because you can move only apps
that are currently deployed to CloudHub to other CloudHub workers. 
For example, you can't move an app that is currently deployed on a local server to CloudHub.
. If you want to copy the environment variables and Mule version from the source application, select *Merge environment variables and mule version*.
. Click *Apply*.
. Click tabs to configure application options.
+
See <<configure-application-settings,Configure Application Settings>>.
. Click *Deploy Application*.

== Application Names 

The application name can contain between 3 and 42 alphanumeric characters (a-z, A-Z, 0-9) and dashes (-).
They cannot contain spaces or other characters.

The application name identifies your application not only in Runtime Manager but also in the public `cloudhub.io` domain.
For example, an application named `myapplication` is accessible at `+http://myapplication.cloudhub.io+`.

To avoid domain conflicts, the application name must be globally unique across CloudHub.
For this reason, create a naming convention to ensure unique application names.
For example, you could prepend your company name and department to all application names,
such as `mycompany-mydept-myapplication`.
You can then add DNS records to hide the complex application name.
For example, you might route requests to `myapplication.mycompany.com` to `mycompany-mydept-myapplication.cloudhub.io`.

Using the CloudHub dedicated load balancer, you can also implement mapping rules to set your application's public URL to any other path, as long as you own the domain.
See xref:lb-mapping-rules.adoc[Mapping Rules].

== Configure Application Settings 

You can configure the application deployment by clicking the tabs on the *Deploy Application* page:

.The arrow shows the configuration tabs on the *Deploy Application* page.
image::cloudhub-deploy-app-config-tabs.png[Configuration tabs on the Deploy Application page]


* <<Runtime Tab Settings,Runtime>>
* <<Autoscaling Tab Settings,Autoscaling>>
* <<Properties Tab Settings,Properties>>
* <<Insight Tab Settings,Insight>>
* <<Logging Tab Settings,Logging>>
* <<Static IPs Tab Settings,Static IPs>>



=== Runtime Tab Settings 

The *Runtime* tab includes the following settings:

Runtime version::
The runtime version must be the same Mule version used to develop your application.
+
After you deploy the app, CloudHub automatically alerts you when updates for the selected runtime version are available. 
See xref::cloudhub-app-runtime-version-updates.adoc[Updating the Runtime Version for CloudHub Apps].

Worker size::
See <<Worker Size and vCores>>.
Workers::
When you deploy an application with more than one worker, CloudHub automatically balances any incoming traffic load across your allocated workers.
See xref:cloudhub-fabric.adoc[Clustering].

Region::
If you have global deployment enabled on your account, you can change the deployment region.
+
When you change the region, the domain is automatically updated. 
+
See xref:cloudhub-networking-guide.adoc#regional-services[Regional Services]. 

Automatically restart application when not responding::
CloudHub automatically restarts your application when the monitoring system discovers an issue.
+
See xref:worker-monitoring.adoc[Application Monitoring and Automatic Restarts].
Persistent queues::
+
You can use persistent queues on your application to store data in an input queue to disk.
Persistent queues protect against message loss and enable you to distribute workloads across a set of workers.
+
See xref:managing-queues.adoc[Managing Queues].
+
Before you can take advantage of persistent queueing, you must set up your application to use queues.
+
See xref:cloudhub-fabric.adoc[Clustering].

Encrypt persistent queues::
If you enable persistent queues, you can optionally encrypt the data stored in the input queue on disk.
Use Object Store v2::
Object Store v2 is enabled by default in Mule 4.
In Mule 3, select this option to access Object Store v2.
+
See xref:object-store::index.adoc[Object Store V2].
Enable Monitoring and Visualizer::
Use Anypoint Monitoring and Visualizer for Mule applications running on supported versions of Mule.
+
This option appears only you if have a Titanium subscription to Anypoint Monitoring enabled for your organization.
+
See xref:monitoring::index.adoc[Anypoint Monitoring] and xref:visualizer::index.adoc[Anypoint Visualizer].


=== Autoscaling Tab Settings

Autoscaling enables you to define policies that respond to CPU or memory usage thresholds by scaling up or down the processing resources used by an application.

This tab doesn't appear by default.
See xref:autoscaling-in-cloudhub.adoc[Autoscaling in CloudHub] for information.


=== Properties Tab Settings

You can specify properties (key-value pairs) that the application uses during deployment and while running in the *Properties* tab.

[NOTE]
When you deploy an application from a nonproduction environment (*Get from sandbox*), the new application inherits any properties defined in the original application.
You can update these properties as required on the *Properties* tab before deploying the application.

See xref:cloudhub-manage-props.adoc[Managing Properties for Applications on CloudHub] and xref:secure-application-properties.adoc[Safely Hiding Application Properties].


=== Insight Tab Settings

You can enable the Insight analytics feature and specify metadata options on the *Insight* tab.
See xref:insight.adoc[Insight].


=== Logging Tab Settings

CloudHub stores activity logs, which you can view or download from Runtime Manager.
See xref:viewing-log-data.adoc[Viewing Log Data].

You can configure the logging level (`DEBUG`, `WARN`, `ERROR`, or `INFO`) for the application on the *Logging* tab.

Alternatively, you can configure logging by modifying the `level` value in the `log4j2.xml` file.
See xref:mule-runtime::logging-in-mule.adoc#configuring-custom-logging-settings[Configuring Custom Logging Settings] and https://logging.apache.org/log4j/2.x/manual/configuration.html[Apache Logging Services].

=== Static IPs Tab Settings

You can allocate a static IP address for your application deployed in specific regions in the *Static IPs* tab.

If an application has static IP addresses allocated in multiple regions, the static IP address is assigned when the application is deployed to that region.
You can preconfigure IP address rules for multiple regions for disaster recovery (DR) scenarios.

If your application is already running, applying the static IP address change restarts it using the newly applied static IP address.


By default, the number of static IP addresses allocated to your organization is equal 
to twice the number of production vCores in your subscription.
This number is displayed under the *Use Static IP* checkbox.

If you need to free some of your static IP allocations, you can release unused IP addresses from an application.
If you need to increase your allocation of static IP addresses, contact MuleSoft Support.





== Worker Size and vCores 

On each application, workers are responsible for executing the application logic.

Only running applications count toward workers usage.
Stopped applications do not consume vCore availability.

Worker sizes have different compute, memory, and storage capacities:

[%header,cols="3*a"]
|===
|Worker Size |Heap Memory | Storage 
|0.1 vCores |500 MB | 8 GB
|0.2 vCores |1 GB | 8 GB
|1 vCore |1.5 GB | 12 GB
|2 vCores |3.5 GB | 40 GB
|4 vCores |7.5 GB | 88 GB
|8 vCores |15 GB | 168 GB
|16 vCores |32 GB | 328 GB 
|===


Workers with 0.1 vCores and 0.2 vCores:

* Provide limited CPU and I/O for smaller workloads
* Can burst to higher CPU speeds for a short time
+
This ability helps to improve application startup times and to process infrequent, large workloads.
If you need consistent performance, use workers with more vCores.

Workers with 1 vCore and larger:

* Provide performance consistency.
* Are available only for Mule version 3.6.2 or later, or API gateway version 2.0.2 or later.

Each worker has a minimum of 8 GB of storage, which is used for both system and application storage.
If your application requires more storage (for example, verbose logging), use a worker size of 2 vCores or larger.
Those applications can access the additional storage in `/tmp`.

Depending on how many vCores are allocated to your account, some options might not be available.
If you select more vCores than are available in your account, CloudHub allows you to create the application, but you cannot start your application until the specified vCores are available.


== Change a Deployed Application

You can change most of the settings after deploying an application to CloudHub.

To edit the settings for an application:

. In the *Applications* tab, the application name.
. Click the *Settings* tab.
. Make your changes and click *Apply Changes*

CloudHub redeploys the application with zero downtime.



== Deployment Progress   

CloudHub uploads your application and begins the deployment process, switching
the view to *Logs* so that you can monitor the deployment progress.

The application status indicator changes to yellow to indicate the deployment is in progress.
When the deployment is complete, the application status indicator changes to green, a message
appears in the status area and in the logs to indicate that the application has deployed successfully. 

[NOTE]
While you deploy an application on Mule runtime engine version 4.1.x and later, the xref:api-manager::gatekeeper.adoc#how-gatekeeper-works[Gatekeeper] mechanism works with xref:api-manager::api-auto-discovery-new-concept.adoc[API Autodiscovery] to help determine the readiness of a deployment.
If Gatekeeper considers the application not ready in five minutes, the deployment status is failed.

== Deployment Errors

If an error occurs and the application cannot be deployed, the application status indicator
changes to `Failed`, and the status area indicates that an error occurred.
The logs include details on the application deployment errors.


== See Also

* xref:managing-cloudhub-specific-settings.adoc[Managing CloudHub Specific Settings] 
* xref:managing-applications-on-cloudhub.adoc[Managing Applications on CloudHub]
* xref:monitoring.adoc[Monitoring Applications]
* xref:developing-applications-for-cloudhub.adoc[Developing Applications for CloudHub]
* xref:anypoint-platform-cli.adoc[CloudHub Command-Line Interface]
* xref:cloudhub-api.adoc[CloudHub REST API]
